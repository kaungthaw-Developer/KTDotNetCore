<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
</head>

<body>
    <input type="text" class="form-control" id="txtTest" />
    <button type="button" class="btn btn-success" id="btnSave">Save</button>
    <button type="button" class="btn btn-info" id="btnUpdate">Update</button>
    <table class="table">
        <thead>
            <tr>
                <th></th>
                <th scope="col">No.</th>
                <th scope="col">ID</th>
                <th scope="col">Name</th>
            </tr>
        </thead>
        <tbody id="tbodyTest">

        </tbody>
    </table>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
        integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>
    <script>
        var editID = '';
        loadTable();
        $('#btnSave').click(function () {
            var test = $('#txtTest').val();
            if(test==null || test==''){
             validate("Can not Empty");
            return;
            }
            var lst = getData();
            const data = {
                Id: uuid(),
                Name: test
            }
            lst.push(data);
            localStorage.setItem('Tbl_Test', JSON.stringify(lst));
            loadTable();
            $('#txtTest').val('');
            $('#txtTest').focus();
        })
        function loadTable() {
            $('#tbodyTest').empty();
            var lst = getData();

            $.each(lst, function (key, value) {
                let html = `<tr>
    <td>
        <button type="button" class="btn btn-warning" onclick="Edit(this)" data-id="${value.Id}">Edit</button>
        <button type="button" class="btn btn-danger" onclick="Delete(this)" data-id="${value.Id}">Delete</button>
        </td>
    <td>${key + 1}</td>
    <td>${value.Id}</td>
    <td>${value.Name}</td>
</tr>`;
                $('#tbodyTest').append(html);
            });
        }

        function Edit(edit) {
            let id = $(edit).data('id');
            let data = getData();
            console.log(id);
            const result = data.filter(function (x) {
                return x.Id == id;

            })
            var item = result[0];
            $('#txtTest').val(item.Name).focus();
            editID = item.Id;

        }
        $('#btnUpdate').click(function () {
            const value=$('#txtTest').val();
            if (editID === '') {
                validate("First Choice the Edit");
                    return;
            };
            if(value==null || value.trim()==""){
                validate("Update can not Empty");
                return;
            }
            var data = getData();
            console.log(editID);
            let index = data.findIndex(x => x.Id == editID);
            console.log(index);
            if(value || value.trim()=='')return;
            data[index].Name = value;
            
            editID = '';
            setLocal(data);
            loadTable();
            $('#txtTest').val('');
            $('#txtTest').focus();
        })
        function Delete(ID){
          const deleteID=$(ID).data('id');
            let data=getData();
            let index=data.findIndex(x=> x.Id==deleteID);
            console.log(index);
            data[index] 
            data.splice(index,1);
           
            confirm("Are you sure want to delete?").then((result) => {
          console.log(result);
          if (!result) return;
          let id = $(ID).data("id");
          var lst = getData();
          let index = lst.findIndex((x) => x.Id == id);
          lst.splice(index, 1);

          setLocal(lst);
          loadTable();
          successMsg("Deleting Successful.");
        });
        }
        function uuid() {
            return "10000000-1000-4000-8000-100000000000".replace(/[018]/g, c =>
                (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)
            );
        }
        function getData() {
            var list = [];
            var jsonString = localStorage.getItem('Tbl_Test');
            if (!(jsonString == undefined || jsonString === null || jsonString === '')) {
                list = JSON.parse(jsonString);
            }
            return list;
        }
        function setLocal(data){
            localStorage.setItem('Tbl_Test',JSON.stringify(data));
        }
        function validate(message){
            Swal.fire({
                    title: message,
                    showClass: {
                        popup: `
                        animate__animated
                        animate__fadeInUp
                        animate__faster
                        `
                    }
                    });
        }
        function save(){

        }
        function confirm(message){
            return new Promise(function (resolve, reject) {
          Swal.fire({
            title: "Confirm",
            text: message,
            icon: "warning",
            showCancelButton: true,
            confirmButtonColor: "#3085d6",
            cancelButtonColor: "#d33",
            confirmButtonText: "Yes",
          }).then((result) => {
            resolve(result.isConfirmed);
          });
        });
        }
        function successMsg(message) {
        Swal.fire({
          title: "Success",
          text: message,
          icon: "success",
        });

      }
    </script>

</html>